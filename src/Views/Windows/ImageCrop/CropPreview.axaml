<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             xmlns:components="using:SchoolOrganizer.Src.Views.ProfileCards.Components"
             mc:Ignorable="d" d:DesignWidth="340" d:DesignHeight="230"
             x:Class="SchoolOrganizer.Src.Views.Windows.ImageCrop.CropPreview">

    <UserControl.Styles>
        <!-- Reusable circular icon button style with a stable template so the border is always visible -->
        <Style Selector="Button.IconButton">
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="24"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            Width="{TemplateBinding Width}"
                            Height="{TemplateBinding Height}"
                            Padding="{TemplateBinding Padding}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                        <ContentPresenter
                            Content="{TemplateBinding Content}"
                            ContentTemplate="{TemplateBinding ContentTemplate}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Foreground="{TemplateBinding Foreground}"/>
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>

        <!-- On hover only change the background (do not remove or change the border) -->
        <Style Selector="Button.IconButton:pointerover">
            <Setter Property="Background" Value="{DynamicResource BackgroundTertiaryBrush}"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>

        <!-- Local defaults for material icons used in the buttons so we don't repeat Width/Height/Foreground -->
        <Style Selector="materialIcons|MaterialIcon">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
        </Style>
    </UserControl.Styles>

    <Border Padding="4">
        <Border Background="{DynamicResource BackgroundSecondaryBrush}"
                BorderBrush="{DynamicResource CardBorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="8"
                BoxShadow="{DynamicResource CardBoxShadows}">
        <Grid RowDefinitions="Auto,*,Auto" RowSpacing="10">
            <!-- Heading removed per request -->
            
            <!-- Preview Circle -->
            <Border Grid.Row="1"
                    x:Name="PreviewImageBorder"
                    Width="140"
                    Height="140"
                    BorderBrush="{DynamicResource WhiteColor}"
                    BorderThickness="3"
                    CornerRadius="70"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    ClipToBounds="True">
                <Image x:Name="PreviewImage"
                       Width="134"
                       Height="134"
                       Stretch="UniformToFill"/>
            </Border>
            
            <!-- Action Buttons -->
            <StackPanel Grid.Row="2"
                        Name="ActionButtonsPanel" 
                        Orientation="Horizontal" 
                        Spacing="8" 
                        HorizontalAlignment="Center"
                        IsVisible="False">
                <Button Name="CancelButton" Classes="IconButton" ToolTip.Tip="Cancel" Click="CancelButton_Click">
                    <materialIcons:MaterialIcon Kind="Close" />
                </Button>

                <Button Name="RotateLeftButton" Classes="IconButton" IsEnabled="False" ToolTip.Tip="Rotate Left" Click="RotateLeftButton_Click">
                    <materialIcons:MaterialIcon Kind="RotateLeft" />
                </Button>

                <Button Name="RotateRightButton" Classes="IconButton" IsEnabled="False" ToolTip.Tip="Rotate Right" Click="RotateRightButton_Click">
                    <materialIcons:MaterialIcon Kind="RotateRight" />
                </Button>

                <Button Name="ResetButton" Classes="IconButton" IsEnabled="False" ToolTip.Tip="Reset" Click="ResetButton_Click">
                    <materialIcons:MaterialIcon Kind="Refresh" />
                </Button>

                <Button Name="SaveButton" Classes="IconButton" IsEnabled="False" ToolTip.Tip="Save" Click="SaveButton_Click">
                    <materialIcons:MaterialIcon Kind="Check" />
                </Button>
            </StackPanel>
        </Grid>
        </Border>
    </Border>
</UserControl>