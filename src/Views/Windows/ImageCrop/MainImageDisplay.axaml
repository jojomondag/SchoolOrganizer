<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="SchoolOrganizer.Src.Views.Windows.ImageCrop.MainImageDisplay">

    <UserControl.Styles>
        <!-- Reusable handle style -->
        <Style Selector="Border.Handle">
            <Setter Property="Width" Value="16"/>
            <Setter Property="Height" Value="16"/>
            <Setter Property="Background" Value="{DynamicResource WhiteColor}"/>
            <!-- Make handle border white so the scale circle remains visible on all themes -->
            <Setter Property="BorderBrush" Value="{DynamicResource WhiteColor}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </UserControl.Styles>

    <Border Padding="4" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
        <Border Name="MainImageArea"
                BorderBrush="{DynamicResource BlackColor}"
                BorderThickness="1"
                CornerRadius="8"
                Background="{DynamicResource WhiteColor}"
                Cursor="Hand"
                BoxShadow="{DynamicResource ShadowLight}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
        <Grid Name="ImageContainer" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" ClipToBounds="False">

            <!-- Background when no image (bottom layer) -->
            <Grid Name="BackgroundPattern"
                  IsVisible="True"
                  Background="Transparent"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">
                <TextBlock Text="Click to select an image"
                           Foreground="{DynamicResource TextSecondaryColor}"
                           FontSize="14"
                           TextAlignment="Center"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Grid>

            <!-- Image display (middle layer - on top of background pattern) -->
            <Image Name="MainImage"
                   Stretch="Uniform"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   IsVisible="False">
            </Image>

            <!-- Crop overlay (top layer) -->
            <Grid Name="CropOverlay"
                  IsVisible="False"
                  Background="Transparent"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  ClipToBounds="False">
                <!-- Single path overlay with even-odd hole -->
                <Path Name="OverlayCutout"
                      Fill="{DynamicResource BlackColor}"
                      Opacity="0.4"
                      StrokeThickness="0"
                      IsHitTestVisible="False"/>

                <Grid Name="SelectionGroup"
                      Width="200"
                      Height="200"
                      HorizontalAlignment="Left"
                      VerticalAlignment="Top">
            <Border Name="CropSelection"
                BorderBrush="{DynamicResource WhiteColor}"
                            BorderThickness="3"
                            Background="Transparent"
                            CornerRadius="100"
                            Cursor="SizeAll"
                            Margin="-10"
                            Padding="10"/>
                    <Canvas Name="HandlesLayer">
                        <!-- Rotation/Resize Handles -->
                        <Border Name="HandleTopLeft" Classes="Handle"/>
                        <Border Name="HandleTopRight" Classes="Handle"/>
                        <Border Name="HandleBottomLeft" Classes="Handle"/>
                        <Border Name="HandleBottomRight" Classes="Handle"/>
                    </Canvas>
                </Grid>
            </Grid>

            <!-- Hover hint overlay (shown when hovering over gray area and image is loaded) -->
            <Border Name="HoverHintOverlay"
                    IsVisible="False"
                    Background="{DynamicResource BlackColor}"
                    Opacity="0.75"
                    CornerRadius="8"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Bottom"
                    Margin="0,0,0,16"
                    Padding="16,12"
                    IsHitTestVisible="False"
                    ZIndex="1000">
                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <materialIcons:MaterialIcon Kind="ImageEdit"
                                                 Width="20"
                                                 Height="20"
                                                 Foreground="{DynamicResource WhiteColor}"/>
                    <TextBlock Text="Click to change image"
                               Foreground="{DynamicResource WhiteColor}"
                               FontSize="14"
                               FontWeight="Medium"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>
        </Border>
    </Border>
</UserControl>
