<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:views="using:SchoolOrganizer.Src.Converters"
             x:Class="SchoolOrganizer.Src.Views.ProfileCards.Components.ProfileImage"
             x:Name="Root">

  <UserControl.Resources>
    <views:UniversalImageConverter x:Key="UniversalImageConverter" x:Shared="True"/>
    <views:SimpleMathConverter x:Key="SimpleMathConverter" x:Shared="True"/>
  </UserControl.Resources>

  <UserControl.Styles>
    <Style Selector="Border.circle">
      <Setter Property="Width" Value="200"/>
      <Setter Property="Height" Value="200"/>
      <Setter Property="CornerRadius" Value="100"/>
      <Setter Property="BorderBrush" Value="Black"/>
      <Setter Property="BorderThickness" Value="3"/>
      <Setter Property="Background" Value="White"/>
      <Setter Property="BoxShadow" Value="0 1 3 1 LightGray"/>
      <Setter Property="Transitions">
        <Transitions>
          <BoxShadowsTransition Property="BoxShadow" Duration="0:0:0.3"/>
        </Transitions>
      </Setter>
    </Style>
    
    <Style Selector="Border.circle:pointerover">
      <Setter Property="BoxShadow" Value="0 2 8 2 Gray"/>
    </Style>
  </UserControl.Styles>

  <Grid ClipToBounds="False" Margin="10">
    <Border Classes="circle"
            Width="{Binding Width, ElementName=Root}"
            Height="{Binding Height, ElementName=Root}"
            CornerRadius="{Binding Width, ElementName=Root, Converter={StaticResource SimpleMathConverter}, ConverterParameter='Divide,2'}"
            BorderBrush="{DynamicResource BlackBrush}"
            BorderThickness="{Binding BorderThickness, ElementName=Root}"
            Background="{DynamicResource BackgroundTertiaryBrush}"
            Cursor="{Binding Cursor, ElementName=Root}"
            ClipToBounds="False">
      
      <Grid>
        <!-- Profile image or placeholder -->
        <Grid>
          <!-- Profile image -->
          <Ellipse x:Name="ProfileImageEllipse"
                   Width="{Binding Width, ElementName=Root}"
                   Height="{Binding Height, ElementName=Root}"
                   Margin="3"
                   IsVisible="{Binding !IsImageMissing, ElementName=Root}">
            <Ellipse.Fill>
              <ImageBrush Source="{Binding ImagePath, ElementName=Root, Converter={StaticResource UniversalImageConverter}}" 
                          Stretch="UniformToFill"/>
            </Ellipse.Fill>
          </Ellipse>
          
          <!-- Placeholder text -->
          <TextBlock x:Name="PlaceholderText"
                     Text="{Binding PlaceholderTextValue, ElementName=Root}" 
                     FontSize="{Binding PlaceholderFontSize, ElementName=Root}"
                     FontWeight="Light" 
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"
                     IsVisible="{Binding IsImageMissing, ElementName=Root}"/>
        </Grid>
        
        <!-- Clickable overlay -->
        <Button Background="Transparent"
                BorderThickness="0"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Cursor="{Binding Cursor, ElementName=Root}"
                Click="OnImageClick"
                IsVisible="{Binding IsClickable, ElementName=Root}"
                Opacity="0"/>
      </Grid>
    </Border>
  </Grid>
</UserControl>
