<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="using:SchoolOrganizer.Views"
        x:Class="SchoolOrganizer.Views.AddStudentWindow"
        x:DataType="views:AddStudentWindow+AddStudentState"
        Width="420" Height="480"
        CanResize="False"
        Title="Add New Student">

  <Window.Resources>
    <views:UniversalImageConverter x:Key="UniversalImageConverter"/>
  </Window.Resources>

  <Window.Styles>
    <Style Selector="TextBox">
      <Setter Property="Padding" Value="12,8"/>
      <Setter Property="BorderBrush" Value="#e0e0e0"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="6"/>
      <Setter Property="Background" Value="White"/>
    </Style>
    
    <Style Selector="TextBox:focus">
      <Setter Property="BorderBrush" Value="#3b536b"/>
    </Style>
    
    <Style Selector="ComboBox">
      <Setter Property="Padding" Value="12,8"/>
      <Setter Property="BorderBrush" Value="#e0e0e0"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="6"/>
      <Setter Property="Background" Value="White"/>
    </Style>
    
    <Style Selector="DatePicker">
      <Setter Property="BorderBrush" Value="#e0e0e0"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="6"/>
      <Setter Property="Background" Value="White"/>
    </Style>
    
    <Style Selector="Button.secondary">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderBrush" Value="#e0e0e0"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="Foreground" Value="#666"/>
      <Setter Property="Padding" Value="20,8"/>
      <Setter Property="CornerRadius" Value="6"/>
    </Style>
    
    <Style Selector="Button.secondary:pointerover">
      <Setter Property="Background" Value="#f5f5f5"/>
    </Style>
    
    <Style Selector="Button.primary">
      <Setter Property="Background" Value="#3b536b"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Padding" Value="24,8"/>
      <Setter Property="CornerRadius" Value="6"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
    </Style>
    
    <Style Selector="Button.primary:pointerover">
      <Setter Property="Background" Value="#2c3e50"/>
    </Style>
  </Window.Styles>

  <Border Background="#f8f9fa" Padding="24">
    <Grid RowDefinitions="Auto,*,Auto">
      <!-- Header -->
      <StackPanel Grid.Row="0" Margin="0,0,0,24">
        <TextBlock Text="Add Student" FontSize="24" FontWeight="Light" Name="TitleText" Foreground="#2c3e50"/>
        <Rectangle Height="1" Fill="#e0e0e0" Margin="0,8,0,0"/>
      </StackPanel>

      <!-- Content -->
      <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,0,-4,0">
        <StackPanel Spacing="20" Margin="0,0,20,0">
          <!-- Photo and Class/Mentor Section -->
          <Grid ColumnDefinitions="140,20,*">
            <!-- Profile Image -->
            <StackPanel Grid.Column="0" Spacing="8">
              <Grid Width="100" Height="100">
                <Border Width="100" Height="100" CornerRadius="50" ClipToBounds="True" Background="#f0f0f0" BorderBrush="#e0e0e0" BorderThickness="2">
                  <Grid>
                    <Image Source="{Binding SelectedImagePath, Converter={StaticResource UniversalImageConverter}}" Stretch="UniformToFill"/>
                    <TextBlock Text="+" FontSize="28" FontWeight="Light" Foreground="#999" HorizontalAlignment="Center" VerticalAlignment="Center" IsVisible="{Binding IsImageMissing}"/>
                  </Grid>
                </Border>
                <!-- Transparent clickable overlay -->
                <Button Background="Transparent"
                        BorderThickness="0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Cursor="Hand"
                        Click="OnChooseImageClick"
                        ToolTip.Tip="Add photo"/>
              </Grid>
              <TextBlock Text="Add Photo" FontSize="12" Foreground="#666" HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- Class and Mentor in 2 rows -->
            <Grid Grid.Column="2" RowDefinitions="Auto,16,Auto">
              <StackPanel Grid.Row="0">
                <TextBlock Text="Class" FontSize="13" FontWeight="Medium" Foreground="#555" Margin="0,0,0,6"/>
                <ComboBox Name="ClassBox" ItemsSource="{Binding AvailableClasses}"/>
              </StackPanel>

              <StackPanel Grid.Row="2">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Grid.Column="0" Text="Mentors" FontSize="13" FontWeight="Medium" Foreground="#555" Margin="0,0,0,6"/>
                  <Button Grid.Column="1" Content="+ Add Mentor" 
                          Classes="secondary" FontSize="11" 
                          Padding="8,4" Margin="0,0,0,6"
                          Click="OnAddMentorClick"/>
                </Grid>
                
                <!-- Selected Mentors List -->
                <ItemsControl Name="SelectedMentorsList" ItemsSource="{Binding SelectedMentors}" Margin="0,0,0,8">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Border Background="#e8f4f8" CornerRadius="4" Padding="8,4" Margin="0,2">
                        <Grid ColumnDefinitions="*,Auto">
                          <TextBlock Grid.Column="0" Text="{Binding}" VerticalAlignment="Center" FontSize="12"/>
                          <Button Grid.Column="1" Content="Ã—" FontSize="14" FontWeight="Bold"
                                  Background="Transparent" BorderThickness="0" 
                                  Foreground="#666" Padding="4,0"
                                  Click="OnRemoveMentorClick" Tag="{Binding}"
                                  ToolTip.Tip="Remove mentor"/>
                        </Grid>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- Mentor Selection ComboBox (initially hidden) -->
                <ComboBox Name="MentorBox" ItemsSource="{Binding AvailableMentors}" 
                          IsVisible="False" SelectionChanged="OnMentorSelected"/>
              </StackPanel>
            </Grid>
          </Grid>

          <!-- Other Form Fields -->
          <StackPanel Spacing="16">
            <StackPanel>
              <TextBlock Text="Name *" FontSize="13" FontWeight="Medium" Foreground="#555" Margin="0,0,0,6"/>
              <TextBox Name="NameBox" Watermark="Enter full name"/>
            </StackPanel>

            <StackPanel>
              <TextBlock Text="Email" FontSize="13" FontWeight="Medium" Foreground="#555" Margin="0,0,0,6"/>
              <TextBox Name="EmailBox" Watermark="student@example.com"/>
            </StackPanel>

            <StackPanel>
              <TextBlock Text="Enrollment Date" FontSize="13" FontWeight="Medium" Foreground="#555" Margin="0,0,0,6"/>
              <DatePicker Name="EnrollmentPicker"/>
            </StackPanel>
          </StackPanel>
        </StackPanel>
      </ScrollViewer>

      <!-- Footer -->
      <StackPanel Grid.Row="2" Margin="0,24,0,0">
        <Rectangle Height="1" Fill="#e0e0e0" Margin="0,0,0,16"/>
        <Grid ColumnDefinitions="*,Auto,Auto">
          <TextBlock Grid.Column="0" Name="ValidationText" Foreground="#e74c3c" VerticalAlignment="Center" FontSize="13"/>
          <Button Grid.Column="1" Content="Cancel" Classes="secondary" Click="OnCancelClick" Margin="0,0,12,0"/>
          <Button Grid.Column="2" Content="Add Student" Classes="primary" Click="OnAddClick" Name="PrimaryButton"/>
        </Grid>
      </StackPanel>
    </Grid>
  </Border>
</Window>


