<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SchoolOrganizer.ViewModels"
             xmlns:converters="using:SchoolOrganizer.Views.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="SchoolOrganizer.Views.ClassroomDownload.ClassroomDownloadView"
             x:DataType="vm:ClassroomDownloadViewModel">

    <UserControl.Resources>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:BoolToStatusTextConverter x:Key="BoolToStatusTextConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0"
                Background="{DynamicResource BackgroundSecondaryColor}"
                Padding="20"
                Margin="0,0,0,10">
            <StackPanel Spacing="10">
                <TextBlock Text="Google Classroom Downloads"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryColor}"/>

                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="Download Folder:"
                               VerticalAlignment="Center"
                               Foreground="{DynamicResource TextSecondaryColor}"/>
                    <TextBox Text="{Binding SelectedFolderPath}"
                             Width="400"
                             IsReadOnly="True"
                             Background="{DynamicResource BackgroundTertiaryColor}"/>
                    <Button Content="Browse..."
                            Click="OnBrowseFolderClick"
                            Padding="15,8"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Classrooms List Section -->
        <Border Grid.Row="1"
                Background="{DynamicResource BackgroundPrimaryColor}"
                Padding="20"
                CornerRadius="8"
                Margin="20,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <TextBlock Text="Available Courses:"
                           FontWeight="Bold"
                           FontSize="16"
                           Grid.Row="0"
                           Margin="0,0,0,10"
                           Foreground="{DynamicResource TextPrimaryColor}"/>

                <ListBox ItemsSource="{Binding Classrooms}"
                         SelectedItem="{Binding SelectedCourse}"
                         Grid.Row="1"
                         Background="Transparent"
                         BorderThickness="0">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border CornerRadius="4"
                                    Padding="12"
                                    Margin="0,4"
                                    BorderThickness="1"
                                    BorderBrush="{DynamicResource BorderColor}"
                                    Background="{DynamicResource BackgroundSecondaryColor}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="{Binding Course.Name}"
                                                   FontSize="14"
                                                   FontWeight="Bold"
                                                   Foreground="{DynamicResource TextPrimaryColor}"/>
                                        <TextBlock Text="{Binding Course.Section}"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource TextSecondaryColor}"/>
                                    </StackPanel>

                                    <!-- Status Indicator -->
                                    <Border Grid.Column="1"
                                            Background="{Binding HasFolder, Converter={StaticResource BoolToColorConverter}}"
                                            Width="12"
                                            Height="12"
                                            CornerRadius="6"
                                            Margin="10,0"
                                            VerticalAlignment="Center"
                                            ToolTip.Tip="{Binding HasFolder, Converter={StaticResource BoolToStatusTextConverter}}"/>

                                    <!-- Button Stack -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                        <!-- View Content Button (only visible if folder exists) -->
                                        <Button Command="{Binding OpenCourseDataCommand}"
                                                IsVisible="{Binding HasFolder}"
                                                Padding="12,6"
                                                Content="View Content"
                                                Background="#2196F3"
                                                Foreground="White"
                                                BorderThickness="0"
                                                CornerRadius="4">
                                            <Button.Styles>
                                                <Style Selector="Button:pointerover">
                                                    <Setter Property="Background" Value="#1976D2"/>
                                                </Style>
                                            </Button.Styles>
                                        </Button>

                                        <!-- View Files Button (only visible if folder exists) -->
                                        <Button Command="{Binding OpenCourseDataCommand}"
                                                IsVisible="{Binding HasFolder}"
                                                Padding="12,6"
                                                Content="View Files"
                                                Background="{DynamicResource BackgroundSecondaryColor}"
                                                Foreground="{DynamicResource TextPrimaryColor}"
                                                BorderThickness="1"
                                                BorderBrush="{DynamicResource BorderColor}"
                                                CornerRadius="4">
                                            <Button.Styles>
                                                <Style Selector="Button:pointerover">
                                                    <Setter Property="Background" Value="{DynamicResource BackgroundTertiaryColor}"/>
                                                </Style>
                                            </Button.Styles>
                                        </Button>

                                        <!-- Download Button -->
                                        <Button Command="{Binding DownloadCommand}"
                                                Padding="12,6"
                                                Content="Download"
                                                Background="{DynamicResource AccentButtonBackground}"
                                                Foreground="White"
                                                BorderThickness="0"
                                                CornerRadius="4">
                                            <Button.Styles>
                                                <Style Selector="Button:pointerover">
                                                    <Setter Property="Background" Value="{DynamicResource AccentButtonBackgroundHover}"/>
                                                </Style>
                                            </Button.Styles>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{DynamicResource BackgroundSecondaryColor}"
                Padding="20,10"
                Margin="0,10,0,0">
            <TextBlock Text="{Binding StatusText}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryColor}"
                       TextWrapping="Wrap"/>
        </Border>
    </Grid>
</UserControl>
