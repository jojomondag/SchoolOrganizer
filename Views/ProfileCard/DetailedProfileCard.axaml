<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:SchoolOrganizer.ViewModels"
             xmlns:models="using:SchoolOrganizer.Models"
             xmlns:views="using:SchoolOrganizer.Views.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="SchoolOrganizer.Views.ProfileCard.DetailedProfileCard"
             x:DataType="models:IPerson">

  <UserControl.Resources>
    <views:UniversalImageConverter x:Key="UniversalImageConverter"/>
    <views:StudentEnrollmentConverter x:Key="StudentEnrollmentConverter"/>
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- No hover effects for DetailedProfileCard (used in Expanded/fullscreen view) -->
  </UserControl.Styles>

  <!-- Main Card Container -->
  <Border x:Name="DetailedCard"
          Classes="DetailedCard"
          Background="{DynamicResource WhiteColor}" 
          CornerRadius="16" 
          BoxShadow="{DynamicResource ShadowLight}"
          Margin="0"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch"
          BorderThickness="1"
          BorderBrush="{DynamicResource BlackColor}"
          ClipToBounds="False">

    <!-- Main Content Grid -->
    <Grid Margin="40">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" MinWidth="280"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Left Side - Profile Image -->
      <StackPanel Grid.Column="0" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="0,10,40,0">
        
        <!-- Profile Image -->
        <Border x:Name="ProfileImageBorder"
                Classes="ProfileImageBorder"
                Background="{DynamicResource TransparentColor}"
                CornerRadius="120"
                BorderThickness="4"
                BorderBrush="{DynamicResource BlackColor}"
                Padding="0"
                PointerReleased="OnProfileImagePointerReleased"
                Cursor="Hand"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Width="240"
                Height="240"
                Margin="0,0,0,20">
          
          <!-- Circular Profile Image -->
          <Grid x:Name="ProfileImageGrid" Width="230" Height="230">
            <!-- Background circle for when no image is present -->
            <Ellipse x:Name="ProfileImageBackground"
                     Width="230" 
                     Height="230"
                     Fill="{DynamicResource BackgroundSecondaryColor}"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"/>
            
            <!-- Profile image overlay -->
            <Ellipse x:Name="ProfileImageEllipse"
                     Width="230" 
                     Height="230"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center">
              <Ellipse.Fill>
                <ImageBrush Source="{Binding PictureUrl, Converter={StaticResource UniversalImageConverter}}"
                            Stretch="UniformToFill"/>
              </Ellipse.Fill>
            </Ellipse>
          </Grid>
        </Border>

        <!-- Image Edit Hint -->
        <TextBlock Text="Click image to edit"
                   Foreground="{DynamicResource BlackColor}"
                   HorizontalAlignment="Center"
                   FontSize="12"
                   FontStyle="Italic"/>

      </StackPanel>

      <!-- Right Side - Detailed Information -->
      <StackPanel Grid.Column="1" VerticalAlignment="Top" Margin="0,10,0,0">
        
        <!-- Name -->
        <TextBlock x:Name="NameText"
                   Text="{Binding Name}" 
                   FontWeight="Bold" 
                   FontSize="36"
                   Foreground="{DynamicResource BlackColor}"
                   Margin="0,0,0,15"
                   TextWrapping="Wrap"/>
        
        <!-- Role/Class Information -->
        <Border Background="{DynamicResource BlackColor}" 
                CornerRadius="8" 
                Padding="16,8" 
                HorizontalAlignment="Left"
                Margin="0,0,0,25">
          <TextBlock x:Name="RoleText"
                     Text="{Binding RoleInfo}" 
                     Foreground="{DynamicResource WhiteColor}"
                     FontSize="18"
                     FontWeight="SemiBold"/>
        </Border>
        
        <!-- Details Section -->
        <StackPanel Margin="0,10,0,0" Spacing="20">
          
          <!-- Email -->
          <StackPanel IsVisible="{Binding Email, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
            <TextBlock Text="Email Address" 
                       FontSize="14" 
                       FontWeight="SemiBold" 
                       Foreground="{DynamicResource BlackColor}"
                       Margin="0,0,0,5"/>
            <TextBlock x:Name="EmailText"
                       Text="{Binding Email}" 
                       FontSize="18"
                       Foreground="{DynamicResource BlackColor}"
                       Margin="0,0,0,0"/>
          </StackPanel>
          
          <!-- Secondary Info (Mentor) -->
          <StackPanel IsVisible="{Binding SecondaryInfo, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
            <TextBlock Text="Mentor" 
                       FontSize="14" 
                       FontWeight="SemiBold" 
                       Foreground="{DynamicResource BlackColor}"
                       Margin="0,0,0,5"/>
            <TextBlock x:Name="SecondaryText"
                       Text="{Binding SecondaryInfo}" 
                       FontSize="18"
                       Foreground="{DynamicResource BlackColor}"/>
          </StackPanel>
          
          <!-- Enrollment Date (for Students) -->
          <StackPanel x:Name="EnrollmentSection">
            <TextBlock Text="Enrollment Date" 
                       FontSize="14" 
                       FontWeight="SemiBold" 
                       Foreground="{DynamicResource BlackColor}"
                       Margin="0,0,0,5"/>
            <TextBlock x:Name="EnrollmentText"
                       FontSize="18"
                       Foreground="{DynamicResource BlackColor}">
              <TextBlock.Text>
                <MultiBinding StringFormat="{}{0:MMMM d, yyyy}">
                  <Binding Path="." Converter="{StaticResource StudentEnrollmentConverter}"/>
                </MultiBinding>
              </TextBlock.Text>
            </TextBlock>
          </StackPanel>

          <!-- Student ID -->
          <StackPanel>
            <TextBlock Text="Student ID" 
                       FontSize="14" 
                       FontWeight="SemiBold" 
                       Foreground="{DynamicResource BlackColor}"
                       Margin="0,0,0,5"/>
            <TextBlock x:Name="IdText"
                       Text="{Binding Id}" 
                       FontSize="18"
                       Foreground="{DynamicResource BlackColor}"
                       FontFamily="Consolas"/>
          </StackPanel>

        </StackPanel>

      </StackPanel>
    </Grid>
  </Border>
</UserControl>